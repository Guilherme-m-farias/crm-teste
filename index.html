<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>CRM Moderno</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; background: #f4f6f8; color: #333; }
    h1 { color: #222; }
    .card, .filters, .actions { background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
    table { width: 100%; border-collapse: collapse; background: #fff; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    th, td { border: 1px solid #e0e0e0; padding: 10px; text-align: left; }
    th { background: #f8f8f8; }
    select, input[type="text"], input[type="date"], textarea {
      width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 8px;
    }
    button { background: #007bff; color: white; border: none; padding: 10px 14px; border-radius: 8px; cursor: pointer; }
    button:hover { background: #0056b3; }

    .float-btn {
      position: fixed; bottom: 30px; right: 30px; background: #28a745; border-radius: 50%; width: 60px; height: 60px;
      display: flex; align-items: center; justify-content: center; font-size: 30px; color: white; box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
             background: rgba(0, 0, 0, 0.5); justify-content: center; align-items: center; }
    .modal-content {
      background: #fff; padding: 20px; border-radius: 12px; width: 600px; max-width: 90%;
    }
    .modal-header { display: flex; justify-content: space-between; align-items: center; }
    .close-btn { background: none; border: none; font-size: 24px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>CRM Moderno</h1>

  <div class="filters">
    <label>Status:
      <select id="filtroStatus" onchange="renderizarTabela()">
        <option value="">Todos</option>
        <option>Interessado</option>
        <option>Em negocia√ß√£o</option>
        <option>Fechou</option>
        <option>Sem interesse</option>
      </select>
    </label>
    <label>Vendedor:
      <input type="text" id="filtroCadastradoPor" oninput="renderizarTabela()" placeholder="Filtrar por quem cadastrou">
    </label>
  </div>

  <div class="actions">
    <button onclick="exportarCSV()">üìÅ Exportar para Excel (.csv)</button>
  </div>

  <table>
    <thead>
      <tr>
        <th>Nome</th>
        <th>Telefone</th>
        <th>Produto</th>
        <th>Status</th>
        <th>√öltimo Contato</th>
        <th>Quem Cadastrou</th>
        <th>A√ß√µes</th>
      </tr>
    </thead>
    <tbody id="tabelaClientes"></tbody>
  </table>

  <div class="float-btn" onclick="abrirModal()">+</div>

  <div class="modal" id="modalForm">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Novo Cliente</h2>
        <button class="close-btn" onclick="fecharModal()">√ó</button>
      </div>
      <form id="clienteForm">
        <label>Nome: <input type="text" id="nome" required></label><br>
        <label>Telefone: <input type="text" id="telefone"></label><br>
        <label>Produto: <input type="text" id="produto"></label><br>
        <label>Data da Compra: <input type="date" id="dataCompra"></label><br>
        <label>Status:
          <select id="status">
            <option>Interessado</option>
            <option>Em negocia√ß√£o</option>
            <option>Fechou</option>
            <option>Sem interesse</option>
          </select>
        </label><br>
        <label>√öltimo Contato: <input type="date" id="ultimoContato"></label><br>
        <label>Quem Cadastrou: <input type="text" id="cadastradoPor" required></label><br>
        <label>Observa√ß√µes: <textarea id="observacoes"></textarea></label><br>
        <div style="display: flex; gap: 10px;">
          <button type="submit">Salvar</button>
          <button type="button" onclick="fecharModal()">Cancelar</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    const modal = document.getElementById('modalForm');
    const form = document.getElementById('clienteForm');
    const tabela = document.getElementById('tabelaClientes');
    const filtroStatus = document.getElementById('filtroStatus');
    const filtroCadastradoPor = document.getElementById('filtroCadastradoPor');

    let clientes = JSON.parse(localStorage.getItem('clientes') || '[]');
    renderizarTabela();

    function abrirModal() {
      modal.style.display = 'flex';
    }
    function fecharModal() {
      modal.style.display = 'none';
      form.reset();
    }

    form.onsubmit = function(e) {
      e.preventDefault();
      const cliente = {
        nome: nome.value,
        telefone: telefone.value,
        produto: produto.value,
        dataCompra: dataCompra.value,
        status: status.value,
        ultimoContato: ultimoContato.value,
        observacoes: observacoes.value,
        cadastradoPor: cadastradoPor.value
      };
      clientes.push(cliente);
      localStorage.setItem('clientes', JSON.stringify(clientes));
      renderizarTabela();
      fecharModal();
    };

    function renderizarTabela() {
      tabela.innerHTML = '';
      const statusFiltro = filtroStatus.value.toLowerCase();
      const vendedorFiltro = filtroCadastradoPor.value.toLowerCase();

      clientes.forEach((c, i) => {
        const statusOk = !statusFiltro || c.status.toLowerCase() === statusFiltro;
        const vendedorOk = !vendedorFiltro || c.cadastradoPor.toLowerCase().includes(vendedorFiltro);

        if (statusOk && vendedorOk) {
          const row = tabela.insertRow();
          row.innerHTML = `
            <td>${c.nome}</td>
            <td>${c.telefone}</td>
            <td>${c.produto}</td>
            <td>
              <select onchange="editarStatus(${i}, this.value)">
                <option ${c.status === 'Interessado' ? 'selected' : ''}>Interessado</option>
                <option ${c.status === 'Em negocia√ß√£o' ? 'selected' : ''}>Em negocia√ß√£o</option>
                <option ${c.status === 'Fechou' ? 'selected' : ''}>Fechou</option>
                <option ${c.status === 'Sem interesse' ? 'selected' : ''}>Sem interesse</option>
              </select>
            </td>
            <td>${c.ultimoContato}</td>
            <td>${c.cadastradoPor}</td>
            <td><button onclick="deletar(${i})">üóë</button></td>
          `;
        }
      });
    }

    function editarStatus(index, novoStatus) {
      clientes[index].status = novoStatus;
      localStorage.setItem('clientes', JSON.stringify(clientes));
    }

    function deletar(index) {
      clientes.splice(index, 1);
      localStorage.setItem('clientes', JSON.stringify(clientes));
      renderizarTabela();
    }

    function exportarCSV() {
      const csv = ['Nome,Telefone,Produto,Status,√öltimo Contato,Quem Cadastrou'];
      clientes.forEach(c => {
        csv.push(`${c.nome},${c.telefone},${c.produto},${c.status},${c.ultimoContato},${c.cadastradoPor}`);
      });
      const blob = new Blob([csv.join('\\n')], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "clientes.csv";
      link.click();
    }
  </script>
</body>
</html>
